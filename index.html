<!doctype html>
<html lang="id">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>AgroScan - Deteksi Hama</title>

Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  <script>
Â  Â  tailwind.config = {
Â  Â  Â  theme: {
Â  Â  Â  Â  extend: {
Â  Â  Â  Â  Â  colors: { 
Â  Â  Â  Â  Â  Â  primary: '#10B981', // Hijau Cerah
Â  Â  Â  Â  Â  Â  warning: '#f97316',
Â  Â  Â  Â  Â  Â  secondary: '#047857', // Hijau Gelap
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  screens: { 'lg': '1024px' }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }
Â  </script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
Â  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@3.1.0/dist/mobilenet.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">
Â  <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl p-6 lg:p-8">
Â  Â  
Â  Â  <header class="mb-6 border-b pb-4">
Â  Â  Â  <a href="index.html" class="text-sm text-primary hover:underline mb-2 block">â† Kembali ke Beranda Aplikasi</a>
Â  Â  Â  <h1 class="text-3xl font-bold text-gray-800">ğŸ”¬ Deteksi Hama <span id="tanamanTitle" class="text-secondary font-light"></span></h1>
Â  Â  Â  <p class="text-sm text-gray-500 mt-1">Gunakan model MobileNet atau Simulasi untuk mendeteksi hama.</p>
Â  Â  </header>

Â  Â  <div class="lg:flex lg:space-x-8">
Â  Â  Â  <div class="w-full lg:w-1/2">
Â  Â  Â  Â  <h2 class="text-lg font-semibold text-gray-700 mb-3">1) Unggah Gambar & Pindai</h2>
Â  Â  Â  Â  <label for="fileInput" class="block text-sm font-medium text-gray-700 mb-2">Pilih foto daun, serangga, atau area yang terinfeksi</label>
Â  Â  Â  Â  <input id="fileInput" type="file" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20 cursor-pointer">

Â  Â  Â  Â  <div class="mt-4 border border-gray-200 rounded-lg overflow-hidden flex justify-center items-center bg-gray-100 min-h-[200px]">
Â  Â  Â  Â  Â  <img id="preview" alt="Preview gambar akan muncul di sini" class="max-w-full max-h-[300px] object-contain" />
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div class="flex space-x-4 mt-6">
Â  Â  Â  Â  Â  <button id="btnDetect" class="flex-1 py-3 px-4 bg-primary text-white font-bold rounded-lg shadow-md hover:bg-secondary transition duration-150 disabled:opacity-50">
Â  Â  Â  Â  Â  Â  Scan (TFJS MobileNet)
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  <button id="btnMock" class="flex-1 py-3 px-4 bg-warning text-white font-bold rounded-lg shadow-md hover:bg-warning/80 transition duration-150 disabled:opacity-50">
Â  Â  Â  Â  Â  Â  Scan (Simulasi Hama)
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div id="resultArea" class="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg hidden">
Â  Â  Â  Â  Â  <div class="text-green-700 font-semibold mb-2" id="status">Menunggu input...</div>
Â  Â  Â  Â  Â  <ul id="predictions" class="list-disc list-inside text-sm text-green-600"></ul>
Â  Â  Â  Â  Â  <div id="remedyDisplay" class="mt-4 border-t border-green-200 pt-3"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  <div class="w-full lg:w-1/2 mt-8 lg:mt-0">
Â  Â  Â  Â  <h2 class="text-lg font-semibold text-gray-700 mb-3">2) Info & Batasan Model</h2>
Â  Â  Â  Â  <div class="p-4 bg-yellow-50 rounded-lg border border-yellow-200 text-sm text-gray-700">
Â  Â  Â  Â  Â  <p>Saat ini, deteksi menggunakan **MobileNet** (model umum). Hasilnya hanya berupa label umum (misalnya: "kutu," "daun").</p>
Â  Â  Â  Â  Â  <p class="mt-2 font-semibold">Gunakan tombol "Simulasi Hama" untuk melihat contoh hasil deteksi hama spesifik berdasarkan pilihan tanaman Anda.</p>
Â  Â  Â  Â  </div>

Â  Â  Â  </div>
Â  Â  </div>

Â  </div>

<script>
Â  // Elemen
Â  const fileInput = document.getElementById('fileInput');
Â  const preview = document.getElementById('preview');
Â  const btnDetect = document.getElementById('btnDetect');
Â  const btnMock = document.getElementById('btnMock');
Â  const resultArea = document.getElementById('resultArea');
Â  const status = document.getElementById('status');
Â  const predictionsDiv = document.getElementById('predictions');
Â  const remedyDisplay = document.getElementById('remedyDisplay');
Â  const tanamanTitle = document.getElementById('tanamanTitle');

Â  let loadedModel = null;
Â  let selectedType = 'umum'; 

Â  // Ambil jenis tanaman dari URL (?type=padi atau ?type=umum)
Â  const params = new URLSearchParams(window.location.search);
Â  selectedType = params.get('type') || 'umum';

Â  // Sesuaikan judul berdasarkan jenis tanaman
Â  if (selectedType === 'padi') {
Â  Â  tanamanTitle.textContent = 'â€” Tanaman Padi';
Â  } else if (selectedType === 'umum') {
Â  Â  tanamanTitle.textContent = 'â€” Tanaman Kebun Umum';
Â  } else {
Â  Â  tanamanTitle.textContent = 'â€” Pilihan Tanaman';
Â  }
Â  
Â  // Daftar Hama Spesifik berdasarkan Jenis Tanaman
Â  const HAMA_LIST_PADI = [
Â  Â  Â  { name: 'Penggerek Batang Padi (Sundep/Beluk)', remedy: 'Keringkan sawah sejenak dan gunakan insektisida sistemik Fipronil atau Kartap Hidroklorida.', color: 'red' },
Â  Â  Â  { name: 'Penyakit Virus Tungro', remedy: 'Segera cabut tanaman yang terinfeksi parah. Kontrol vektornya (Wereng Hijau) menggunakan insektisida spesifik.', color: 'red' },
Â  Â  Â  { name: 'Wereng Batang Coklat (WBC)', remedy: 'Gunakan varietas tahan wereng. Aplikasi insektisida sistemik (misal: BPMC) pada populasi tinggi.', color: 'red' }
Â  ];

Â  const HAMA_LIST_UMUM = [
Â  Â  Â  { name: 'Kutu Kebul/Aphid', remedy: 'Gunakan insektisida berbahan aktif Imidakloprid atau Tiametoksam. Non-kimia: Semprotan air sabun.', color: 'red' },
Â  Â  Â  { name: 'Serangan Ulat (Defoliasi)', remedy: 'Gunakan insektisida biologis Bacillus thuringiensis (Bt) atau pestisida dengan bahan aktif Deltametrin.', color: 'red' },
Â  Â  Â  { name: 'Kekurangan Nitrogen (Menguning Daun)', remedy: 'Segera berikan pupuk yang kaya Nitrogen (Urea atau ZA) melalui aplikasi daun atau tanah.', color: 'yellow' },
Â  Â  Â  { name: 'Penyakit Jamur (Bercak Daun)', remedy: 'Gunakan fungisida berbahan aktif Mankozeb atau Azoksistrobin. Kurangi kelembaban daun.', color: 'red' },
Â  ];


Â  // --- LOGIKA UTAMA ---

Â  // Preview gambar
Â  fileInput.addEventListener('change', (ev) => {
Â  Â  const f = ev.target.files && ev.target.files[0];
Â  Â  if (!f) return;
Â  Â  const url = URL.createObjectURL(f);
Â  Â  preview.src = url;
Â  Â  preview.style.display = 'block';
Â  Â  resultArea.style.display = 'none';
Â  Â  remedyDisplay.innerHTML = '';
Â  });

Â  // Fungsi util: tampilkan hasil
Â  function showResult(text, preds=[]) {
Â  Â  resultArea.style.display = 'block';
Â  Â  status.textContent = text;
Â  Â  predictionsDiv.innerHTML = '';
Â  Â  remedyDisplay.innerHTML = ''; 
Â  Â  
Â  Â  if (preds.length) {
Â  Â  Â  const ul = document.createElement('ul');
Â  Â  Â  preds.forEach(p => {
Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  li.textContent = `${p.className} â€” confidence: ${(p.probability*100).toFixed(1)}%`; 
Â  Â  Â  Â  ul.appendChild(li);
Â  Â  Â  });
Â  Â  Â  predictionsDiv.appendChild(ul);
Â  Â  }
Â  }

Â  // Load MobileNet (async)
Â  async function ensureMobilenet() {
Â  Â  if (loadedModel && loadedModel.name === 'mobilenet') return loadedModel;
Â  Â  showResult('Memuat MobileNet dari CDN... (sekali, membutuhkan koneksi)');
Â  Â  loadedModel = await mobilenet.load({ version: 3, alpha: 1.0 });
Â  Â  loadedModel.name = 'mobilenet';
Â  Â  showResult('MobileNet siap. Silakan klik Scan lagi.');
Â  Â  return loadedModel;
Â  }

Â  // Ambil elemen img dari preview
Â  function imgElementFromPreview() {
Â  Â  if (!preview.src) return null;
Â  Â  const img = new Image();
Â  Â  img.crossOrigin = 'anonymous';
Â  Â  img.src = preview.src;
Â  Â  return img;
Â  }


Â  // Run MobileNet classification (TIDAK BERUBAH karena MobileNet umum)
Â  async function classifyWithMobilenet() {
Â  Â  const imgEl = imgElementFromPreview();
Â  Â  if (!imgEl) { showResult('Belum ada gambar.'); return; }
Â  Â  showResult('Melakukan prediksi (MobileNet)...');
Â  Â  await imgEl.decode();
Â  Â  const model = await ensureMobilenet();
Â  Â  const preds = await model.classify(imgEl, 5);
Â  Â  showResult('Hasil prediksi (MobileNet):', preds);
Â  Â  
Â  Â  // Rekomendasi Umum
Â  Â  const isPest = preds.some(p => /insect|bug|fly|bee|ant|beetle|grasshopper/i.test(p.className));
Â  Â  if (isPest) {
Â  Â  Â  predictionsDiv.insertAdjacentHTML('beforeend', `<p class="mt-2 text-red-700 font-bold">Peringatan: Kemungkinan ditemukan serangga/hama. Periksa lebih lanjut.</p>`); 
Â  Â  Â  remedyDisplay.innerHTML = `<div class="bg-red-50 p-3 rounded-md mt-2">
Â  Â  Â  Â  <h4 class="text-lg font-semibold text-red-700 mb-1">Rekomendasi Penanganan Umum:</h4>
Â  Â  Â  Â  <p class="text-sm text-red-600">Karena deteksi umum 'serangga', segera lakukan inspeksi visual. Gunakan insektisida non-sistemik ringan atau metode biologis.</p>
Â  Â  Â  </div>`;
Â  Â  } else {
Â  Â  Â  remedyDisplay.innerHTML = `<div class="bg-green-50 p-3 rounded-md mt-2">
Â  Â  Â  Â  <h4 class="text-lg font-semibold text-green-700 mb-1">Status Umum:</h4>
Â  Â  Â  Â  <p class="text-sm text-green-600">Tidak terdeteksi serangga atau penyakit umum. Lanjutkan perawatan rutin.</p>
Â  Â  Â  </div>`;
Â  Â  }
Â  }

Â  // Mock detection (Simulasi Hama)
Â  function mockDetect() {
Â  Â  if (!preview.src) { showResult('Silakan pilih gambar terlebih dahulu.'); return; }
Â  Â  showResult(`Menjalankan deteksi simulasi untuk ${selectedType === 'padi' ? 'Padi' : 'Tanaman Umum'}...`);
Â  Â  
Â  Â  // Pilih daftar hama berdasarkan URL
Â  Â  const hamaList = selectedType === 'padi' ? HAMA_LIST_PADI : HAMA_LIST_UMUM;

Â  Â  // Logika simulasi
Â  Â  const file = fileInput.files && fileInput.files[0];
Â  Â  const size = file ? file.size : 0;
Â  Â  const seed = (size % 100) / 100;
Â  Â  const chance = Math.random() * 0.5 + seed * 0.5; // peluang deteksi

Â  Â  if (chance > 0.5) { 
Â  Â  Â  Â  const detectedHama = hamaList[Math.floor(Math.random() * hamaList.length)];
Â  Â  Â  Â  
Â  Â  Â  Â  showResult(`Hasil Simulasi: Ditemukan ${detectedHama.name}`, [{ className: detectedHama.name, probability: chance }]);
Â  Â  Â  Â  
Â  Â  Â  Â  // Tampilkan rekomendasi
Â  Â  Â  Â  const bgColor = detectedHama.color === 'red' ? 'bg-red-50' : 'bg-yellow-50';
Â  Â  Â  Â  const textColor = detectedHama.color === 'red' ? 'text-red-700' : 'text-yellow-700';
Â  Â  Â  Â  
Â  Â  Â  Â  remedyDisplay.innerHTML = `<div class="p-3 rounded-md mt-2 ${bgColor}">
Â  Â  Â  Â  Â  <h4 class="text-lg font-semibold ${textColor} mb-1">Rekomendasi Penanganan:</h4>
Â  Â  Â  Â  Â  <p class="text-sm ${textColor}">${detectedHama.remedy}</p>
Â  Â  Â  Â  </div>`;

Â  Â  } else {
Â  Â  Â  Â  showResult('Hasil Simulasi: Tanaman Sehat / Normal', [{ className: 'Sehat/normal', probability: 1-chance }]);
Â  Â  Â  Â  remedyDisplay.innerHTML = `<div class="bg-green-50 p-3 rounded-md mt-2">
Â  Â  Â  Â  Â  <h4 class="text-lg font-semibold text-green-700 mb-1">Rekomendasi Perawatan Rutin:</h4>
Â  Â  Â  Â  Â  <p class="text-sm text-green-600">Lanjutkan perawatan rutin.</p>
Â  Â  Â  Â  </div>`;
Â  Â  }
Â  }
Â  

Â  // Event Listener Tombol Utama
Â  btnDetect.addEventListener('click', async () => classifyWithMobilenet());
Â  btnMock.addEventListener('click', () => mockDetect());

Â  // Inisialisasi: kosongkan preview
Â  preview.style.display = 'none';
Â  preview.src = '';
</script>
</body>
</html>
