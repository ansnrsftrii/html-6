<!doctype html>
<html lang="id">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AgroScan - Aplikasi Pertanian Modern All-in-One</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Konfigurasi Tailwind CSS
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#10B981', // Hijau Cerah
                        secondary: '#047857', // Hijau Lebih Gelap
                        accent: '#ECFDF5', // Latar belakang elemen ringan
                        textDark: '#1F2937', // Teks gelap
                        textMuted: '#6B7280', // Teks abu-abu
                        danger: '#EF4444', // Merah untuk Hama
                        warning: '#f97316', // Oranye
                    },
                    screens: { 'md': '768px', 'lg': '1024px' }
                }
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@3.1.0/dist/mobilenet.min.js"></script>
</head>
<body class="bg-gray-100 min-h-screen font-sans">
    
    <div id="app-container" class="max-w-md mx-auto bg-white shadow-lg rounded-b-3xl overflow-hidden md:max-w-lg">

        <div id="page-index" data-page="index" class="min-h-screen">
            
            <div class="bg-primary px-6 py-4 flex items-center justify-between text-white">
                <div class="flex items-center">
                    <span class="text-2xl font-bold mr-2">üå±</span>
                    <h1 class="text-xl font-semibold">AgroScan</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button class="focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.007 2.007 0 0118 14.07V10c0-2.856-2.572-5.186-5.714-5.186S6.572 7.144 6.572 10v4.07c0 .762-.317 1.49-.87 2.01L4 17h5m6 0v1a3 3 0 01-6 0v-1m6 0H9"/></svg></button>
                    <button class="focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 0a9 9 0 11-18 0 9 9 0 0118 0z"/></svg></button>
                </div>
            </div>

            <div class="bg-primary pt-2 pb-6 px-6 relative z-10">
                <h2 class="text-white text-base mb-3 opacity-90">Pilih Tanaman Anda</h2>
                <div class="flex space-x-4 overflow-x-auto pb-2">
                    <div class="flex-shrink-0 text-center">
                        <a href="#" onclick="navigate('detect', {type: 'padi'})" class="block w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-md mb-1"><span class="text-3xl">üåæ</span></a>
                        <p class="text-xs text-white opacity-90">Padi</p>
                    </div>
                    <div class="flex-shrink-0 text-center">
                        <a href="#" onclick="navigate('detect', {type: 'cabai'})" class="block w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-md mb-1"><span class="text-3xl">üå∂Ô∏è</span></a>
                        <p class="text-xs text-white opacity-90">Cabai</p>
                    </div>
                    <div class="flex-shrink-0 text-center">
                        <a href="#" onclick="navigate('detect', {type: 'jagung'})" class="block w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-md mb-1"><span class="text-3xl">üåΩ</span></a>
                        <p class="text-xs text-white opacity-90">Jagung</p>
                    </div>
                    <div class="flex-shrink-0 text-center">
                        <a href="#" onclick="navigate('detect', {type: 'tomat'})" class="block w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-md mb-1"><span class="text-3xl">üçÖ</span></a>
                        <p class="text-xs text-white opacity-90">Tomat</p>
                    </div>
                    <div class="flex-shrink-0 text-center">
                        <a href="#" onclick="navigate('detect', {type: 'umum'})" class="block w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-md mb-1"><span class="text-3xl">ü•¨</span></a>
                        <p class="text-xs text-white opacity-90">Sayuran</p>
                    </div>
                </div>
            </div>

            <div class="relative -mt-4 bg-white px-6 py-8 rounded-t-3xl shadow-inner z-20">
                
                <h2 class="text-lg font-semibold text-textDark mb-4">Fitur AgroScan</h2>
                <div class="grid grid-cols-2 gap-4 mb-8">
                    
                    <a href="#" onclick="navigate('detect')" class="block bg-accent rounded-xl p-4 shadow-sm hover:bg-opacity-80 transition">
                        <span class="text-2xl mb-2 block"></span>
                        <h3 class="font-medium text-textDark">Deteksi Hama & Penyakit</h3>
                        <p class="text-xs text-textMuted mt-1">Identifikasi masalah tanaman Anda.</p>
                    </a>
                    
                    <a href="#" onclick="navigate('kalkulator-pupuk')" class="block bg-accent rounded-xl p-4 shadow-sm hover:bg-opacity-80 transition">
                        <span class="text-2xl mb-2 block"></span>
                        <h3 class="font-medium text-textDark">Kalkulator Pupuk</h3>
                        <p class="text-xs text-textMuted mt-1">Dapatkan dosis pupuk yang tepat.</p>
                    </a>
                    
                    <a href="#" onclick="navigate('tips-budidaya')" class="block bg-accent rounded-xl p-4 shadow-sm hover:bg-opacity-80 transition">
                        <span class="text-2xl mb-2 block"></span>
                        <h3 class="font-medium text-textDark">Tips Budidaya</h3>
                        <p class="text-xs text-textMuted mt-1">Panduan praktis untuk hasil optimal.</p>
                    </a>
                    
                    <a href="#" onclick="navigate('info-padi')" class="block bg-accent rounded-xl p-4 shadow-sm hover:bg-opacity-80 transition">
                        <span class="text-2xl mb-2 block"></span>
                        <h3 class="font-medium text-textDark">Katalog Hama Padi</h3>
                        <p class="text-xs text-textMuted mt-1">Lihat detail hama padi, gejala, dan gambar.</p>
                    </a>
                </div>

                <h2 class="text-lg font-semibold text-textDark mb-4">Sembuhkan Tanaman Anda</h2>
                <div class="bg-accent rounded-xl p-6 shadow-sm">
                    <div class="flex items-center justify-around text-center mb-6">
                        <div class="flex flex-col items-center">
                            <span class="text-3xl text-primary mb-1"></span>
                            <p class="text-xs text-textMuted">Ambil gambar</p>
                        </div>
                        <span class="text-xl text-gray-400">‚Üí</span>
                        <div class="flex flex-col items-center">
                            <span class="text-3xl text-primary mb-1"></span>
                            <p class="text-xs text-textMuted">Lihat diagnosis</p>
                        </div>
                        <span class="text-xl text-gray-400">‚Üí</span>
                        <div class="flex flex-col items-center">
                            <span class="text-3xl text-primary mb-1"></span>
                            <p class="text-xs text-textMuted">Rekomendasi obat</p>
                        </div>
                    </div>
                    <a href="#" onclick="navigate('detect')" class="block w-full py-3 bg-primary text-white font-semibold rounded-lg shadow-md hover:bg-secondary transition duration-150 text-center">
                        <span class="mr-2"></span> Ambil Gambar
                    </a>
                </div>
            </div>

        </div> <div id="page-detect" data-page="detect" class="min-h-screen p-4 sm:p-8 hidden">
            <div class="max-w-4xl mx-auto bg-white p-6 lg:p-8">
                <header class="mb-6 border-b pb-4">
                    <a href="#" onclick="navigate('index')" class="text-sm text-primary hover:underline mb-2 block">‚Üê Kembali ke Beranda Aplikasi</a>
                    <h1 class="text-3xl font-bold text-gray-800"> Deteksi Hama Canggih <span id="tanamanTitle" class="text-secondary font-light"></span></h1>
                    <p class="text-sm text-gray-500 mt-1">Gunakan fitur Simulasi Canggih untuk diagnosis berdasarkan Gejala.</p>
                </header>

                <div class="lg:flex lg:space-x-8">
                    <div class="w-full lg:w-1/2">
                        <h2 class="text-lg font-semibold text-gray-700 mb-3">1) Unggah Gambar & Pindai</h2>
                        <label for="fileInput" class="block text-sm font-medium text-gray-700 mb-2">Pilih foto daun, serangga, atau area yang terinfeksi</label>
                        <input id="fileInput" type="file" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20 cursor-pointer">

                        <div class="mt-4 border border-gray-200 rounded-lg overflow-hidden flex justify-center items-center bg-gray-100 min-h-[200px]">
                            <img id="preview" alt="Preview gambar akan muncul di sini" class="max-w-full max-h-[300px] object-contain" style="display:none;" />
                        </div>

                        <div class="flex space-x-4 mt-6">
                            <button id="btnDetect" class="flex-1 py-3 px-4 bg-gray-300 text-gray-700 font-bold rounded-lg shadow-md transition duration-150 disabled:opacity-50" disabled>
                                Scan (MobileNet - Umum)
                            </button>
                            <button id="btnMock" class="flex-1 py-3 px-4 bg-primary text-white font-bold rounded-lg shadow-md hover:bg-secondary transition duration-150 disabled:opacity-50">
                                Scan (Simulasi Canggih)
                            </button>
                        </div>

                        <div id="resultArea" class="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg hidden">
                            <div class="text-green-700 font-semibold mb-2" id="status">Menunggu input...</div>
                            <ul id="predictions" class="list-disc list-inside text-sm text-green-600"></ul>
                            <div id="remedyDisplay" class="mt-4 border-t border-green-200 pt-3"></div>
                        </div>
                    </div>

                    <div class="w-full lg:w-1/2 mt-8 lg:mt-0">
                        <h2 class="text-lg font-semibold text-gray-700 mb-3">2) Fitur Canggih</h2>
                        <div class="p-4 bg-primary/10 rounded-lg border border-primary/20 text-sm text-gray-700">
                            <p class="font-bold text-primary">Simulasi Canggih</p>
                            <p>Fitur ini mensimulasikan model AI terlatih yang mampu memberikan **diagnosis ganda** (misalnya, hama utama **dan** masalah nutrisi) yang lebih realistis dan terperinci.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div> <div id="page-info-padi" data-page="info-padi" class="min-h-screen p-4 sm:p-8 hidden">
            <div class="max-w-4xl mx-auto bg-white p-6 lg:p-8">
                <header class="mb-6 border-b pb-4">
                    <a href="#" onclick="navigate('index')" class="text-sm text-primary hover:underline mb-2 block">‚Üê Kembali ke Beranda Aplikasi</a>
                    <h1 class="text-3xl font-bold text-gray-800"> Katalog Hama & Penyakit Padi</h1>
                    <p class="text-sm text-gray-500 mt-1">Pelajari lebih dalam ciri-ciri, gejala, dan pengendalian hama padi utama.</p>
                </header>

                <div class="space-y-8">
                    
                    <div id="sundep" class="p-6 bg-accent rounded-lg border-l-4 border-danger shadow-md">
                        <h2 class="text-2xl font-bold text-danger mb-3">üêõ Penggerek Batang Padi</h2>
                        <p class="text-sm text-gray-700 mb-4">Penggerek Batang (larva ngengat) masuk ke dalam batang padi. Dikenal sebagai **Sundep** pada fase muda dan **Beluk** pada fase berbuah.</p>
                        <div class="md:flex md:space-x-4">
                            <div class="md:w-1/2">
                                <h3 class="font-semibold text-gray-800 mt-2">Gejala Utama:</h3>
                                <ul class="list-disc list-inside text-sm text-gray-600">
                                    <li>Pucuk daun mati dan mengering (*Sundep*).</li>
                                    <li>Malai putih, hampa, dan tegak (*Beluk*).</li>
                                </ul>
                            </div>
                            <div class="md:w-1/2 mt-4 md:mt-0">
                                
                            </div>
                        </div>
                    </div>
                    
                    <div id="wereng" class="p-6 bg-accent rounded-lg border-l-4 border-danger shadow-md">
                        <h2 class="text-2xl font-bold text-danger mb-3"> Wereng Batang Coklat (WBC)</h2>
                        <p class="text-sm text-gray-700 mb-4">Wereng menghisap cairan batang padi, seringkali menyebabkan *hopperburn* (padi kering seperti terbakar).</p>
                        <div class="md:flex md:space-x-4">
                            <div class="md:w-1/2">
                                <h3 class="font-semibold text-gray-800 mt-2">Gejala Utama:</h3>
                                <ul class="list-disc list-inside text-sm text-gray-600">
                                    <li>Tanaman mengering dan mati secara melingkar (*hopperburn*).</li>
                                    <li>Ditemukan serangga kecil berwarna coklat di pangkal batang.</li>
                                </ul>
                            </div>
                            <div class="md:w-1/2 mt-4 md:mt-0">
                                
                            </div>
                        </div>
                    </div>

                    <div id="tungro" class="p-6 bg-accent rounded-lg border-l-4 border-danger shadow-md">
                        <h2 class="text-2xl font-bold text-danger mb-3"> Virus Tungro</h2>
                        <p class="text-sm text-gray-700 mb-4">Penyakit virus yang ditularkan oleh Wereng Hijau. Dapat menyebabkan kerugian hasil panen yang sangat besar.</p>
                        <div class="md:flex md:space-x-4">
                            <div class="md:w-1/2">
                                <h3 class="font-semibold text-gray-800 mt-2">Gejala Utama:</h3>
                                <ul class="list-disc list-inside text-sm text-gray-600">
                                    <li>Tanaman menjadi kerdil dan daunnya menguning sampai oranye.</li>
                                    <li>Daun termuda seringkali memiliki bercak berkarat.</li>
                                </ul>
                            </div>
                            <div class="md:w-1/2 mt-4 md:mt-0">
                                
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> <div id="page-kalkulator-pupuk" data-page="kalkulator-pupuk" class="min-h-screen p-4 sm:p-8 hidden">
             <div class="max-w-4xl mx-auto bg-white p-6 lg:p-8">
                <header class="mb-6 border-b pb-4">
                    <a href="#" onclick="navigate('index')" class="text-sm text-primary hover:underline mb-2 block">‚Üê Kembali ke Beranda Aplikasi</a>
                    <h1 class="text-3xl font-bold text-gray-800"> Kalkulator Pupuk (Simulasi)</h1>
                    <p class="text-sm text-gray-500 mt-1">Hitung simulasi kebutuhan pupuk berdasarkan luas lahan.</p>
                </header>

                <div class="space-y-6">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div class="col-span-1">
                            <label for="luasLahan" class="block text-sm font-medium text-gray-700">Luas Lahan (dalam Hektar)</label>
                            <input type="number" id="luasLahan" value="1.0" min="0.1" step="0.1" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary p-2 border">
                        </div>
                        
                        <div class="col-span-1">
                            <label for="jenisTanaman" class="block text-sm font-medium text-gray-700">Jenis Tanaman</label>
                            <select id="jenisTanaman" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-primary focus:ring-primary p-2 border">
                                <option value="padi">Padi Sawah</option>
                                <option value="jagung">Jagung</option>
                                <option value="cabai">Cabai</option>
                            </select>
                        </div>
                    </div>
                        
                    <button id="calculateBtn" class="w-full py-3 px-4 bg-primary text-white font-bold rounded-lg shadow-md hover:bg-secondary transition duration-150">
                        Hitung Kebutuhan Pupuk
                    </button>

                    <div id="resultPupuk" class="mt-6 p-6 bg-accent rounded-lg border border-primary/20 hidden">
                        <h3 class="text-xl font-bold text-secondary mb-3">Rekomendasi Dosis (Per Hektar)</h3>
                        <div id="dosisDetails" class="space-y-2">
                            </div>
                    </div>
                </div>
            </div>
        </div> <div id="page-tips-budidaya" data-page="tips-budidaya" class="min-h-screen p-4 sm:p-8 hidden">
            <div class="max-w-4xl mx-auto bg-white p-6 lg:p-8">
                <header class="mb-6 border-b pb-4">
                    <a href="#" onclick="navigate('index')" class="text-sm text-primary hover:underline mb-2 block">‚Üê Kembali ke Beranda Aplikasi</a>
                    <h1 class="text-3xl font-bold text-gray-800"> Tips Budidaya Modern</h1>
                    <p class="text-sm text-gray-500 mt-1">Panduan praktis untuk meningkatkan kualitas dan hasil panen.</p>
                </header>

                <div class="space-y-8">
                    
                    <div class="p-6 bg-accent rounded-lg border-l-4 border-primary shadow-md">
                        <h2 class="text-2xl font-bold text-secondary mb-3">Tips Khusus: Tanaman Padi üåæ</h2>
                        <ul class="list-disc list-inside text-gray-700 space-y-3">
                            <li>**Teknik Pengairan Berselang (Intermittent Irrigation):** Keringkan sawah selama 3-5 hari sebelum pemupukan kedua untuk mengendalikan Wereng dan memperkuat perakaran.</li>
                            <li>**Pemupukan Berimbang:** Jangan hanya mengandalkan Urea (N). Pastikan dosis Fosfor (P) dan Kalium (K) terpenuhi sesuai umur tanaman untuk mencegah penyakit rebah dan meningkatkan kualitas gabah.</li>
                            <li>**Jarak Tanam Jajar Legowo:** Terapkan Jajar Legowo untuk sirkulasi udara yang lebih baik, mengurangi kelembaban, dan memudahkan aplikasi pupuk.</li>
                        </ul>
                    </div>
                    
                    <div class="p-6 bg-gray-50 rounded-lg border-l-4 border-gray-400 shadow-md">
                        <h2 class="text-2xl font-bold text-gray-700 mb-3">Tips Umum: Tanaman Kebun üå∂Ô∏èüçÖ</h2>
                        <ul class="list-disc list-inside text-gray-600 space-y-3">
                            <li>**Rotasi Tanaman:** Jangan menanam tanaman sejenis terus-menerus di lahan yang sama untuk memutus siklus hidup hama dan penyakit tular tanah.</li>
                            <li>**Drainase:** Pastikan media tanam memiliki drainase yang baik. Air yang menggenang adalah penyebab utama penyakit busuk akar dan jamur.</li>
                            <li>**Aplikasi Pestisida Biologis:** Prioritaskan penggunaan pestisida hayati (misalnya, *Trichoderma* untuk jamur tanah, *Bacillus thuringiensis* untuk ulat) sebagai pencegahan.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div> </div> <script>
    // =================================================================================
    // LOGIKA NAVIGASI (MULTI-PAGE SIMULATION)
    // =================================================================================

    // Fungsi untuk menampilkan halaman yang diminta dan menyembunyikan yang lain
    function navigate(pageId, params = {}) {
        const pages = document.querySelectorAll('[data-page]');
        pages.forEach(page => {
            page.classList.add('hidden');
        });
        
        const targetPage = document.getElementById('page-' + pageId);
        if (targetPage) {
            targetPage.classList.remove('hidden');
            // Jika pindah ke halaman detect, jalankan fungsi inisialisasi
            if (pageId === 'detect') {
                initializeDetectPage(params);
            }
        }
        
        // Atur agar konten yang tampil (max-w-md/lg) sesuai dengan halaman tujuan
        const appContainer = document.getElementById('app-container');
        if (pageId === 'index') {
            appContainer.classList.remove('md:max-w-4xl');
            appContainer.classList.add('md:max-w-lg');
        } else {
            appContainer.classList.remove('md:max-w-lg');
            appContainer.classList.add('md:max-w-4xl');
        }
        
        // Gulir ke atas halaman baru
        window.scrollTo(0, 0);
    }

    // Panggil navigate('index') saat halaman dimuat
    document.addEventListener('DOMContentLoaded', () => {
        navigate('index');
    });
    
    // =================================================================================
    // LOGIKA DETEKSI HAMA (dari detect.html)
    // =================================================================================
    
    // Data Hama dan Masalah
    const PADI_PROBLEMS = [
        { name: 'Penggerek Batang Padi (Sundep/Beluk)', remedy: 'Keringkan sawah sejenak dan gunakan insektisida sistemik Fipronil.', type: 'danger', priority: 1, link: '#sundep' },
        { name: 'Wereng Batang Coklat (WBC)', remedy: 'Gunakan varietas tahan wereng. Aplikasi insektisida sistemik BPMC pada populasi tinggi.', type: 'danger', priority: 1, link: '#wereng' },
        { name: 'Penyakit Virus Tungro', remedy: 'Cabut tanaman terinfeksi parah. Kontrol vektor Wereng Hijau dengan insektisida spesifik.', type: 'danger', priority: 1, link: '#tungro' },
        { name: 'Kekurangan Nitrogen (Daun Kuning)', remedy: 'Segera berikan pupuk Urea atau ZA.', type: 'warning', priority: 2, link: '' },
        { name: 'Kekurangan Kalium (Ujung Daun Kering)', remedy: 'Tambahkan pupuk KCL.', type: 'warning', priority: 2, link: '' }
    ];

    const UMUM_PROBLEMS = [
        { name: 'Kutu Kebul/Aphid (Daun Keriting)', remedy: 'Gunakan insektisida Imidakloprid. Alternatif: semprotan air sabun.', type: 'danger', priority: 1, link: '' },
        { name: 'Penyakit Jamur (Bercak Daun)', remedy: 'Aplikasi fungisida Mankozeb atau Azoksistrobin. Kurangi kelembaban.', type: 'danger', priority: 1, link: '' },
        { name: 'Serangan Ulat Defoliasi', remedy: 'Gunakan insektisida biologis Bacillus thuringiensis (Bt).', type: 'danger', priority: 1, link: '' },
        { name: 'Kekurangan Fosfor (Daun Ungu/Merah)', remedy: 'Berikan pupuk SP-36 atau NPK yang mengandung Fosfor tinggi.', type: 'warning', priority: 2, link: '' },
        { name: 'Kekurangan Kalsium (Bunga Busuk)', remedy: 'Tambahkan pupuk Kalsium Boron.', type: 'warning', priority: 2, link: '' }
    ];

    let selectedType = 'umum';

    function initializeDetectPage(params) {
        selectedType = params.type || 'umum';
        const tanamanTitle = document.getElementById('tanamanTitle');
        const preview = document.getElementById('preview');
        const resultArea = document.getElementById('resultArea');
        const fileInput = document.getElementById('fileInput');

        // Reset tampilan
        if (tanamanTitle) {
            tanamanTitle.textContent = selectedType === 'padi' ? '‚Äî Tanaman Padi' : selectedType.charAt(0).toUpperCase() + selectedType.slice(1);
        }
        if (preview) {
            preview.style.display = 'none';
            preview.src = '';
        }
        if (resultArea) {
            resultArea.classList.add('hidden');
        }
        if (fileInput) {
             fileInput.value = null;
        }

        // Tautkan kembali event listener karena elemen dimuat ulang atau dipindahkan
        document.getElementById('fileInput').addEventListener('change', handleFileChange);
        document.getElementById('btnMock').addEventListener('click', mockDetect);
        
        // Jika dari beranda, beri tautan ke info-padi.html, perbaiki tautan link di data
        const currentProblems = selectedType === 'padi' ? PADI_PROBLEMS : UMUM_PROBLEMS;
        currentProblems.forEach(p => {
             if (p.link && p.link.startsWith('#')) {
                p.link = `javascript:navigate('info-padi'); setTimeout(() => { document.querySelector('${p.link}').scrollIntoView({ behavior: 'smooth' }); }, 100);`;
            }
        });
    }

    // Fungsi util: tampilkan hasil diagnosis
    function showResult(problems) {
        const resultArea = document.getElementById('resultArea');
        const status = document.getElementById('status');
        const predictionsDiv = document.getElementById('predictions');
        const remedyDisplay = document.getElementById('remedyDisplay');
        
        if (!resultArea || !status || !predictionsDiv || !remedyDisplay) return;

        resultArea.classList.remove('hidden');
        predictionsDiv.innerHTML = '';
        remedyDisplay.innerHTML = ''; 

        if (problems.length === 0) {
            resultArea.className = 'mt-6 p-4 bg-green-50 border border-green-200 rounded-lg';
            status.className = 'text-green-700 font-bold mb-2';
            status.textContent = 'Tanaman Sehat / Normal';
            remedyDisplay.innerHTML = `<div class="bg-green-100 p-3 rounded-md mt-2">
                <p class="text-sm text-green-700">Tidak terdeteksi hama atau masalah signifikan. Lanjutkan program perawatan rutin.</p>
            </div>`;
            return;
        }

        const primaryColor = problems.some(p => p.type === 'danger') ? 'danger' : 'warning';
        const bgColor = primaryColor === 'danger' ? 'bg-red-50' : 'bg-yellow-50';
        const borderColor = primaryColor === 'danger' ? 'border-red-200' : 'border-yellow-200';
        const statusColor = primaryColor === 'danger' ? 'text-red-700' : 'text-yellow-700';

        resultArea.className = `mt-6 p-4 ${bgColor} border ${borderColor} rounded-lg`;
        status.className = `${statusColor} font-bold mb-2`;
        status.textContent = `Hasil Diagnosis: Ditemukan ${problems.length} Masalah!`;

        let remedyContent = `<h4 class="text-lg font-bold ${statusColor} mb-2"> Rekomendasi Penanganan:</h4>`;

        problems.forEach((p, index) => {
            const itemColor = p.type === 'danger' ? 'text-red-600' : 'text-yellow-600';
            
            const li = document.createElement('li');
            li.className = itemColor;
            li.textContent = `${index + 1}. ${p.name} (Prioritas ${p.priority === 1 ? 'Tinggi' : 'Menengah'})`;
            predictionsDiv.appendChild(li);

            const linkHtml = p.link ? `<a href="${p.link}" onclick="${p.link}" class="text-primary hover:underline font-semibold ml-2">(Lihat Detail)</a>` : '';
            
            remedyContent += `<div class="mt-3 ${p.type === 'danger' ? 'border-l-4 border-red-400 pl-3' : 'border-l-4 border-yellow-400 pl-3'}">
                <p class="text-sm ${itemColor} font-semibold">${p.name}:</p>
                <p class="text-xs text-gray-700">${p.remedy} ${linkHtml}</p>
            </div>`;
        });
        
        remedyDisplay.innerHTML = remedyContent;
    }

    // Preview gambar
    function handleFileChange(ev) {
        const preview = document.getElementById('preview');
        const resultArea = document.getElementById('resultArea');
        const remedyDisplay = document.getElementById('remedyDisplay');
        
        const f = ev.target.files && ev.target.files[0];
        if (!f) return;
        const url = URL.createObjectURL(f);
        if (preview) {
             preview.src = url;
             preview.style.display = 'block';
        }
        if (resultArea) resultArea.classList.add('hidden');
        if (remedyDisplay) remedyDisplay.innerHTML = '';
    }
    
    // Mock detection (Simulasi Canggih)
    function mockDetect() {
        const fileInput = document.getElementById('fileInput');
        const preview = document.getElementById('preview');
        const status = document.getElementById('status');
        
        if (!preview || !fileInput || !fileInput.files || fileInput.files.length === 0) {
            if (status) status.textContent = 'Silakan pilih gambar terlebih dahulu.';
            showResult([]);
            return;
        }
        
        if (status) status.textContent = `Menjalankan analisis cerdas...`;

        const allProblems = selectedType === 'padi' ? PADI_PROBLEMS : UMUM_PROBLEMS;
        
        const detectedProblems = [];
        
        // 1. Deteksi Hama Utama (Prioritas 1) - 40% chance
        if (Math.random() < 0.4) {
            const highPriority = allProblems.filter(p => p.priority === 1);
            const detectedHama = highPriority[Math.floor(Math.random() * highPriority.length)];
            detectedProblems.push(detectedHama);
        }

        // 2. Deteksi Masalah Nutrisi (Prioritas 2) - 30% chance
        if (Math.random() < 0.3) {
            const mediumPriority = allProblems.filter(p => p.priority === 2);
            if (mediumPriority.length > 0) {
                const detectedNutrisi = mediumPriority[Math.floor(Math.random() * mediumPriority.length)];
                if (!detectedProblems.find(p => p.name === detectedNutrisi.name)) {
                    detectedProblems.push(detectedNutrisi);
                }
            }
        }

        showResult(detectedProblems);
    }
    
    // =================================================================================
    // LOGIKA KALKULATOR PUPUK (dari kalkulator-pupuk.html)
    // =================================================================================
    
    document.addEventListener('DOMContentLoaded', () => {
        const calculateBtn = document.getElementById('calculateBtn');
        if (calculateBtn) {
            calculateBtn.addEventListener('click', calculatePupuk);
        }
    });

    function calculatePupuk() {
        const luasLahanInput = document.getElementById('luasLahan');
        const jenisTanamanSelect = document.getElementById('jenisTanaman');
        const resultPupukDiv = document.getElementById('resultPupuk');
        const dosisDetailsDiv = document.getElementById('dosisDetails');
        
        if (!luasLahanInput || !jenisTanamanSelect || !resultPupukDiv || !dosisDetailsDiv) return;

        const luas = parseFloat(luasLahanInput.value);
        const jenis = jenisTanamanSelect.value;

        if (isNaN(luas) || luas <= 0) {
            alert('Masukkan luas lahan yang valid.');
            return;
        }

        const BASE_DOSIS = {
            padi: { Urea: 250, NPK: 300, KCL: 100 },
            jagung: { Urea: 300, NPK: 400, Za: 50 },
            cabai: { Urea: 150, NPK: 500, TSP: 100 }
        };

        const dosisDasar = BASE_DOSIS[jenis];
        
        dosisDetailsDiv.innerHTML = '';
        
        for (const pupuk in dosisDasar) {
            const totalDosis = dosisDasar[pupuk] * luas;
            
            const div = document.createElement('div');
            div.className = 'flex justify-between border-b border-primary/30 pb-1';
            div.innerHTML = `<span class="font-semibold text-textDark">${pupuk}:</span> <span class="text-primary font-bold">${totalDosis.toFixed(0)} kg</span>`;
            dosisDetailsDiv.appendChild(div);
        }
        
        resultPupukDiv.classList.remove('hidden');
    }
</script>
</body>
</html>
