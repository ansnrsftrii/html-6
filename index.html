<!doctype html>
<html lang="id">
<head>
Â  <meta charset="utf-8" />
Â  <meta name="viewport" content="width=device-width,initial-scale=1" />
Â  <title>AgroScan - Aplikasi Pertanian</title>

Â  Â  <script src="https://cdn.tailwindcss.com"></script>
Â  
Â  Â  <script>
Â  Â  tailwind.config = {
Â  Â  Â  theme: {
Â  Â  Â  Â  extend: {
Â  Â  Â  Â  Â  colors: {
Â  Â  Â  Â  Â  Â  primary: '#0ea5e9',
Â  Â  Â  Â  Â  Â  warning: '#f97316',
Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  screens: {
Â  Â  Â  Â  Â  Â  'lg': '1024px',
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  }
Â  </script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.9.0/dist/tf.min.js"></script>
Â  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/mobilenet@3.1.0/dist/mobilenet.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen p-4 sm:p-8">
Â  <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-xl p-6 lg:p-8">
Â  Â  
Â  Â  <header class="mb-6 border-b pb-4">
Â  Â  Â  <h1 class="text-3xl font-bold text-gray-800">ðŸŒ± AgroScan <span class="text-primary font-light">â€” Aplikasi Pertanian</span></h1>
Â  Â  Â  <p class="text-sm text-gray-500 mt-1">Demo aplikasi dengan deteksi hama dan informasi tanaman.</p>
Â  Â  </header>

Â  Â  Â  Â  <div class="flex border-b border-gray-200 mb-6">
Â  Â  Â  <button id="tabDetect" data-tab="detect" class="tab-button px-4 py-2 text-sm font-semibold text-primary border-b-2 border-primary transition duration-150">
Â  Â  Â  Â  Deteksi Hama
Â  Â  Â  </button>
Â  Â  Â  <button id="tabInfo" data-tab="info" class="tab-button px-4 py-2 text-sm font-semibold text-gray-500 border-b-2 border-transparent hover:border-gray-300 transition duration-150">
Â  Â  Â  Â  Info Padi & Hama
Â  Â  Â  </button>
Â  Â  </div>

Â  Â  Â  Â  <div id="contentDetect" class="tab-content">
Â  Â  Â  <div class="lg:flex lg:space-x-8">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full lg:w-1/2">
Â  Â  Â  Â  Â  <h2 class="text-lg font-semibold text-gray-700 mb-3">1) Unggah Gambar & Pindai</h2>
Â  Â  Â  Â  Â  <label for="fileInput" class="block text-sm font-medium text-gray-700 mb-2">Pilih foto daun, serangga, atau area yang terinfeksi</label>
Â  Â  Â  Â  Â  <input id="fileInput" type="file" accept="image/*" class="w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20 cursor-pointer">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mt-4 border border-gray-200 rounded-lg overflow-hidden flex justify-center items-center bg-gray-100 min-h-[200px]">
Â  Â  Â  Â  Â  Â  <img id="preview" alt="Preview gambar akan muncul di sini" class="max-w-full max-h-[300px] object-contain" />
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex space-x-4 mt-6">
Â  Â  Â  Â  Â  Â  <button id="btnDetect" class="flex-1 py-3 px-4 bg-primary text-white font-bold rounded-lg shadow-md hover:bg-primary/80 transition duration-150 disabled:opacity-50">
Â  Â  Â  Â  Â  Â  Â  Scan (TFJS MobileNet)
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  <button id="btnMock" class="flex-1 py-3 px-4 bg-warning text-white font-bold rounded-lg shadow-md hover:bg-warning/80 transition duration-150 disabled:opacity-50">
Â  Â  Â  Â  Â  Â  Â  Scan (Simulasi Hama)
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="resultArea" class="mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg hidden">
Â  Â  Â  Â  Â  Â  <div class="text-blue-700 font-semibold mb-2" id="status">Menunggu input...</div>
Â  Â  Â  Â  Â  Â  <ul id="predictions" class="list-disc list-inside text-sm text-blue-600"></ul>
Â  Â  Â  Â  Â  Â  <div id="remedyDisplay" class="mt-4 border-t border-blue-200 pt-3"></div>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="w-full lg:w-1/2 mt-8 lg:mt-0">
Â  Â  Â  Â  Â  <h2 class="text-lg font-semibold text-gray-700 mb-3">2) Opsi Model & Informasi</h2>

Â  Â  Â  Â  Â  <label for="modelOption" class="block text-sm font-medium text-gray-700 mb-2">Pilih Model AI</label>
Â  Â  Â  Â  Â  <select id="modelOption" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
Â  Â  Â  Â  Â  Â  <option value="mobilenet">MobileNet (Model Umum, Demo)</option>
Â  Â  Â  Â  Â  Â  <option value="custom">Model TFJS Custom (URL model.json)</option>
Â  Â  Â  Â  Â  </select>

Â  Â  Â  Â  Â  <div id="customUrlWrap" class="mt-4 hidden">
Â  Â  Â  Â  Â  Â  <label for="customModelUrl" class="block text-sm font-medium text-gray-700 mb-1">URL Model Custom (model.json)</label>
Â  Â  Â  Â  Â  Â  <input id="customModelUrl" placeholder="https://.../model.json" type="text" class="w-full p-2 border border-gray-300 rounded-lg focus:ring-primary focus:border-primary">
Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  <hr class="my-6 border-gray-200">

Â  Â  Â  Â  Â  <h3 class="text-md font-semibold text-gray-700 mb-2">Catatan Model:</h3>
Â  Â  Â  Â  Â  <ul class="list-disc list-inside text-sm text-gray-600 space-y-2">
Â  Â  Â  Â  Â  Â  <li>MobileNet hanya mengenali objek umum, bukan label hama spesifik.</li>
Â  Â  Â  Â  Â  Â  <li>Mode ini adalah **Client-side**, analisis dilakukan di *browser* Anda.</li>
Â  Â  Â  Â  Â  </ul>

Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  Â  Â  Â  <div id="contentInfo" class="tab-content hidden">
Â  Â  Â  <h2 class="text-2xl font-semibold text-secondary mb-4">ðŸŒ¾ Informasi Dasar Padi & Hama Umum</h2>
Â  Â  Â  
Â  Â  Â  <div class="grid md:grid-cols-2 gap-6">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 bg-green-50 rounded-lg border border-green-200">
Â  Â  Â  Â  Â  <h3 class="text-lg font-bold text-green-700 mb-2">Informasi Tanaman Padi (Oryza sativa)</h3>
Â  Â  Â  Â  Â  <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
Â  Â  Â  Â  Â  Â  <li>Padi merupakan tanaman pangan utama di Indonesia.</li>
Â  Â  Â  Â  Â  Â  <li>Dibutuhkan irigasi yang stabil atau curah hujan yang cukup.</li>
Â  Â  Â  Â  Â  Â  <li>Nutrisi utama yang dibutuhkan adalah Nitrogen (N), Fosfor (P), dan Kalium (K).</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-4 bg-red-50 rounded-lg border border-red-200">
Â  Â  Â  Â  Â  <h3 class="text-lg font-bold text-red-700 mb-2">Hama Kunci Tanaman Padi</h3>
Â  Â  Â  Â  Â  <ul class="list-disc list-inside text-sm text-gray-600 space-y-1">
Â  Â  Â  Â  Â  Â  <li>**Wereng Batang Coklat (WBC):** Menyebabkan tanaman kering seperti terbakar (*hopperburn*).</li>
Â  Â  Â  Â  Â  Â  <li>**Penggerek Batang Padi:** Menyebabkan pucuk mati (*sundep*) saat fase vegetatif, atau bulir kosong (*beluk*) saat fase generatif.</li>
Â  Â  Â  Â  Â  Â  <li>**Virus Tungro:** Ditularkan oleh Wereng Hijau, menyebabkan pertumbuhan kerdil dan daun menguning/oranye.</li>
Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>

Â  </div>

<script>
Â  // Elemen Utama
Â  const fileInput = document.getElementById('fileInput');
Â  const preview = document.getElementById('preview');
Â  const btnDetect = document.getElementById('btnDetect');
Â  const btnMock = document.getElementById('btnMock');
Â  const resultArea = document.getElementById('resultArea');
Â  const status = document.getElementById('status');
Â  const predictionsDiv = document.getElementById('predictions');
Â  const remedyDisplay = document.getElementById('remedyDisplay');
Â  const modelOption = document.getElementById('modelOption');
Â  const customUrlWrap = document.getElementById('customUrlWrap');
Â  const customModelUrl = document.getElementById('customModelUrl');

Â  // Elemen Navigasi
Â  const tabButtons = document.querySelectorAll('.tab-button');
Â  const tabContents = document.querySelectorAll('.tab-content');
Â  let loadedModel = null; 


Â  // --- FUNGSI NAVIGASI APLIKASI ---
Â  function showTab(tabId) {
Â  Â  // Sembunyikan semua konten dan hapus status aktif dari tombol
Â  Â  tabContents.forEach(content => content.classList.add('hidden'));
Â  Â  tabButtons.forEach(button => {
Â  Â  Â  button.classList.remove('text-primary', 'border-primary');
Â  Â  Â  button.classList.add('text-gray-500', 'border-transparent');
Â  Â  });

Â  Â  // Tampilkan konten yang dipilih dan tandai tombol aktif
Â  Â  const selectedContent = document.getElementById(`content${tabId.charAt(0).toUpperCase() + tabId.slice(1)}`);
Â  Â  const selectedButton = document.getElementById(`tab${tabId.charAt(0).toUpperCase() + tabId.slice(1)}`);

Â  Â  if (selectedContent) selectedContent.classList.remove('hidden');
Â  Â  if (selectedButton) {
Â  Â  Â  selectedButton.classList.remove('text-gray-500', 'border-transparent');
Â  Â  Â  selectedButton.classList.add('text-primary', 'border-primary');
Â  Â  }
Â  }

Â  tabButtons.forEach(button => {
Â  Â  button.addEventListener('click', (e) => {
Â  Â  Â  showTab(e.target.dataset.tab);
Â  Â  });
Â  });
Â  // Inisialisasi: Tampilkan tab Deteksi saat halaman dimuat
Â  showTab('detect');


Â  // --- FUNGSI DETEKSI DAN LOGIKA HAMA ---

Â  // Tampilkan input URL model saat pilih custom
Â  modelOption.addEventListener('change', () => {
Â  Â  customUrlWrap.style.display = modelOption.value === 'custom' ? 'block' : 'none';
Â  });

Â  // Preview gambar
Â  fileInput.addEventListener('change', (ev) => {
Â  Â  const f = ev.target.files && ev.target.files[0];
Â  Â  if (!f) return;
Â  Â  const url = URL.createObjectURL(f);
Â  Â  preview.src = url;
Â  Â  preview.style.display = 'block';
Â  Â  resultArea.style.display = 'none';
Â  Â  remedyDisplay.innerHTML = ''; 
Â  });

Â  // Fungsi util: tampilkan hasil
Â  function showResult(text, preds=[]) {
Â  Â  resultArea.style.display = 'block';
Â  Â  status.textContent = text;
Â  Â  predictionsDiv.innerHTML = '';
Â  Â  remedyDisplay.innerHTML = ''; 
Â  Â  
Â  Â  if (preds.length) {
Â  Â  Â  const ul = document.createElement('ul');
Â  Â  Â  preds.forEach(p => {
Â  Â  Â  Â  const li = document.createElement('li');
Â  Â  Â  Â  li.textContent = `${p.className} â€” confidence: ${(p.probability*100).toFixed(1)}%`; 
Â  Â  Â  Â  ul.appendChild(li);
Â  Â  Â  });
Â  Â  Â  predictionsDiv.appendChild(ul);
Â  Â  }
Â  }
Â  
Â  // Load MobileNet (async)
Â  async function ensureMobilenet() {
Â  Â  if (loadedModel && loadedModel.name === 'mobilenet') return loadedModel;
Â  Â  showResult('Memuat MobileNet dari CDN... (sekali, membutuhkan koneksi)');
Â  Â  loadedModel = await mobilenet.load({ version: 3, alpha: 1.0 });
Â  Â  loadedModel.name = 'mobilenet';
Â  Â  showResult('MobileNet siap. Silakan klik Scan lagi.');
Â  Â  return loadedModel;
Â  }

Â  // Ambil elemen img dari preview
Â  function imgElementFromPreview() {
Â  Â  if (!preview.src) return null;
Â  Â  const img = new Image();
Â  Â  img.crossOrigin = 'anonymous';
Â  Â  img.src = preview.src;
Â  Â  return img;
Â  }


Â  // Run MobileNet classification
Â  async function classifyWithMobilenet() {
Â  Â  const imgEl = imgElementFromPreview();
Â  Â  if (!imgEl) { showResult('Belum ada gambar.'); return; }
Â  Â  showResult('Melakukan prediksi (MobileNet)...');
Â  Â  await imgEl.decode(); 
Â  Â  const model = await ensureMobilenet();
Â  Â  const preds = await model.classify(imgEl, 5);
Â  Â  showResult('Hasil prediksi (MobileNet):', preds);
Â  Â  
Â  Â  // Logika Rekomendasi Sederhana
Â  Â  const isPest = preds.some(p => /insect|bug|fly|bee|ant|beetle|grasshopper/i.test(p.className));
Â  Â  if (isPest) {
Â  Â  Â  predictionsDiv.insertAdjacentHTML('beforeend', `<p class="mt-2 text-red-700 font-bold">Peringatan: Kemungkinan ditemukan serangga/hama. Periksa lebih lanjut.</p>`); 
Â  Â  Â  remedyDisplay.innerHTML = `<div class="bg-red-50 p-3 rounded-md mt-2">
Â  Â  Â  Â  <h4 class="text-lg font-semibold text-red-700 mb-1">Rekomendasi Penanganan Umum:</h4>
Â  Â  Â  Â  <p class="text-sm text-red-600">Karena deteksi umum 'serangga', segera lakukan inspeksi visual. Gunakan insektisida non-sistemik ringan atau metode biologis.</p>
Â  Â  Â  </div>`;
Â  Â  } else {
Â  Â  Â  remedyDisplay.innerHTML = `<div class="bg-green-50 p-3 rounded-md mt-2">
Â  Â  Â  Â  <h4 class="text-lg font-semibold text-green-700 mb-1">Status Umum:</h4>
Â  Â  Â  Â  <p class="text-sm text-green-600">Tidak terdeteksi serangga atau penyakit umum. Lanjutkan perawatan rutin.</p>
Â  Â  Â  </div>`;
Â  Â  }
Â  }

Â  // Mock detection (Simulasi Hama Padi dan Umum)
Â  function mockDetect() {
Â  Â  if (!preview.src) { showResult('Silakan pilih gambar terlebih dahulu.'); return; }
Â  Â  showResult('Menjalankan deteksi simulasi...');
Â  Â  
Â  Â  // Data Rekomendasi Hama (Termasuk Padi)
Â  Â  const hamaList = [
Â  Â  Â  Â  // Hama Umum Tanaman Kebun
Â  Â  Â  Â  { name: 'Kutu Kebul', remedy: 'Gunakan insektisida berbahan aktif Imidakloprid atau Tiametoksam sesuai dosis. Non-kimia: Gunakan perangkap kuning lengket.', color: 'red' },
Â  Â  Â  Â  { name: 'Serangan Ulat (Defoliasi)', remedy: 'Gunakan insektisida biologis Bacillus thuringiensis (Bt) atau pestisida dengan bahan aktif Deltametrin. Siangi hama secara manual.', color: 'red' },
Â  Â  Â  Â  { name: 'Kekurangan Nitrogen (Menguning)', remedy: 'Segera berikan pupuk yang kaya Nitrogen (Urea atau ZA) melalui aplikasi daun atau tanah.', color: 'yellow' },
Â  Â  Â  Â  { name: 'Penyakit Jamur (Bercak Daun)', remedy: 'Gunakan fungisida berbahan aktif Mankozeb atau Azoksistrobin. Kurangi kelembaban daun.', color: 'red' },
Â  Â  Â  Â  
Â  Â  Â  Â  // Hama Padi (Tambahan)
Â  Â  Â  Â  { name: 'Penggerek Batang Padi (Sundep/Beluk)', remedy: 'Keringkan sawah sejenak (intermittent irrigation) dan gunakan insektisida sistemik seperti Fipronil atau Kartap Hidroklorida.', color: 'red' },
Â  Â  Â  Â  { name: 'Penyakit Virus Tungro', remedy: 'Segera cabut tanaman yang terinfeksi parah. Kontrol vektornya, yaitu Wereng Hijau, menggunakan insektisida spesifik.', color: 'red' }
Â  Â  ];

Â  Â  // Logika simulasi (acak deterministik berdasarkan ukuran file)
Â  Â  const file = fileInput.files && fileInput.files[0];
Â  Â  const size = file ? file.size : 0;
Â  Â  const seed = (size % 100) / 100;
Â  Â  const chance = Math.random() * 0.5 + seed * 0.5;
Â  Â  
Â  Â  if (chance > 0.5) { 
Â  Â  Â  Â  const detectedHama = hamaList[Math.floor(Math.random() * hamaList.length)];
Â  Â  Â  Â  
Â  Â  Â  Â  showResult(`Hasil Simulasi: Ditemukan ${detectedHama.name}`, [{ className: detectedHama.name, probability: chance }]);
Â  Â  Â  Â  
Â  Â  Â  Â  // Tampilkan rekomendasi di area khusus
Â  Â  Â  Â  const bgColor = detectedHama.color === 'red' ? 'bg-red-50' : 'bg-yellow-50';
Â  Â  Â  Â  const textColor = detectedHama.color === 'red' ? 'text-red-700' : 'text-yellow-700';
Â  Â  Â  Â  
Â  Â  Â  Â  remedyDisplay.innerHTML = `<div class="p-3 rounded-md mt-2 ${bgColor}">
Â  Â  Â  Â  Â  <h4 class="text-lg font-semibold ${textColor} mb-1">Rekomendasi Penanganan:</h4>
Â  Â  Â  Â  Â  <p class="text-sm ${textColor}">${detectedHama.remedy}</p>
Â  Â  Â  Â  </div>`;

Â  Â  } else {
Â  Â  Â  Â  showResult('Hasil Simulasi: Tanaman Sehat / Normal', [{ className: 'Sehat/normal', probability: 1-chance }]);
Â  Â  Â  Â  remedyDisplay.innerHTML = `<div class="bg-green-50 p-3 rounded-md mt-2">
Â  Â  Â  Â  Â  <h4 class="text-lg font-semibold text-green-700 mb-1">Rekomendasi Perawatan Rutin:</h4>
Â  Â  Â  Â  Â  <p class="text-sm text-green-600">Lanjutkan perawatan rutin. Pastikan nutrisi (NPK) dan air tercukupi. Jangan menyiram saat malam hari untuk mencegah jamur.</p>
Â  Â  Â  Â  </div>`;
Â  Â  }
Â  }
Â  

Â  // Custom Model (Opsional, perlu URL model.json)
Â  async function classifyWithCustomModel() {
Â  Â  // Logika prediksi model custom ada di sini
Â  Â  // ... (Anda dapat mengisi ini nanti jika sudah memiliki model.json)
Â  Â  showResult('Mode custom belum didukung penuh. Masukkan URL model.json untuk mengaktifkan fitur ini.');
Â  }


Â  // Event Listener Tombol Utama
Â  btnDetect.addEventListener('click', async () => classifyWithMobilenet());
Â  btnMock.addEventListener('click', () => mockDetect());

Â  // Inisialisasi: kosongkan preview
Â  preview.style.display = 'none';
Â  preview.src = '';
</script>
</body>
</html>
